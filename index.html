<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Government Services Schema From Google Spreadsheet In Javascript : This is a project for generating government services schema from a google spreadsheet in JavaScript" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Government Services Schema From Google Spreadsheet In Javascript</title>
    
    <script type="text/javascript" src="javascripts/jquery.js"></script>
    <script type="text/javascript" src="javascripts/tabletop.js"></script>    
    
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/kinlane/government-services-schema-from-google-spreadsheet-in-javascript">View on GitHub</a>

          <h1 id="project_title">Government Services Schema From Google Spreadsheet In Javascript</h1>
          <h2 id="project_tagline">This is a project for generating government services schema from a Google Spreadsheet in JavaScript</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/kinlane/government-services-schema-from-google-spreadsheet-in-javascript/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/kinlane/government-services-schema-from-google-spreadsheet-in-javascript/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        
        <script type="text/javascript">
                    
              var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?key=0AmRmiTou7vbjdGZEaUdpV2lMNTRwZG5GMTdfWWRMUUE&output=html';
        
              $(document).ready( function() {
                Tabletop.init( { key: public_spreadsheet_url,
                                 callback: showInfo,
                                 wanted: [ "Services", "Service Locations" ],
                                 debug: true } )
              })
                
              function showInfo(data, tabletop) {
                $("#table_info").text("We found the tables " + tabletop.model_names.join(", "));
        
                $.each( tabletop.sheets(), function(i, sheet) {
                  $("#table_info").append("<p>" + sheet.name + " has " + sheet.column_names.join(", ") + "</p>");
                });
                
                $.each( tabletop.sheets("Services").all(), function(i, service) {
                    
                    $servicename = service.servicename;
                    $uniqueid = service.uniqueid;
                    $description = service.description;
                    $url = service.url;
                    $image = service.image;
                    $alternatenames = service.alternatenames;
                    $servicearea = service.servicearea;
                    $providername = service.providername;
                    $providerlogo = service.providerlogo;
                    $providerurl = service.providerurl;
                    $operator = service.operator;
                    $servicetype = service.servicetype;
                    $servicetypetaxonomyused = service.servicetypetaxonomyused;
                    $produces = service.produces;
                    $audience = service.audience;
                    $availablelanguages = service.availablelanguages;
                    $serviceurl = service.serviceurl;
                    $servicephone = service.servicephone;   
                    
                    // Let's buil the Schema
                    $Schema = {};
                    $Schema['@context'] = 'http://schema.org/';
                    $Schema['@type'] = 'GovernmentService';
                    $Schema['@id'] = $uniqueid;
                    $Schema['name'] = $servicename;                 
                    
                    // Audience
                    $audienceArray = $audience.split(";");
                    $Audience = {};
                    $Audience["@type"] = "CivicAudience";
                    $Audience['audienceType'] = new Array();
                    $.each($audienceArray, function( key, value ){
                        $Audience['audienceType'].push(value);  
                    })
                                
                    $Schema['audience'] = $Audience;        
                
                    $Schema['Description'] = $description;
                
                    $Provider = {};
                    $Provider["@type"] = "GovernmentOrganization";
                    $Provider["name"] = $providername;
                    $Provider["url"] = $providerurl;
                    $Provider["logo"] = $providerlogo;
                    
                    $Schema['provider'] = $Provider;        
                    
                    $ServiceArea = {};
                    $ServiceArea["@type"] = "Country";
                    $ServiceArea["name"] = "ocd-division/country:us";   
                                    
                    $Schema['serviceArea'] = $ServiceArea;          
        
                    SServiceChannel = {};
                    SServiceChannel["@type"] = "ServiceChannel";
                    SServiceChannel["servicePhone"] = $servicephone;    
                    SServiceChannel["serviceLocation"] = new Array();
        
                    $.each(tabletop.sheets("Service Locations").all(), function(i, servicelocations) {
                        
                        $servicelocation_name = servicelocations.name;
                        $servicelocation_addressstreet = servicelocations.addressstreet;
                        $servicelocation_addresscity = servicelocations.addresscity;
                        $servicelocation_addressstate = servicelocations.addressstate;
                        $servicelocation_addresszip = servicelocations.addresszip;
                        $servicelocation_telephone = servicelocations.telephone;
                        $servicelocation_service_name = servicelocations.servicename;
                                        
                        //echo "Location Name: " . $servicelocation_name . "<br />";
                        //echo "Location Address: " . $servicelocation_addressstreet . "<br />";
                        //echo "Location City: " . $servicelocation_addresscity . "<br />";
                        //echo "Location State: " . $servicelocation_addressstate . "<br />";
                        //echo "Location Zip: " . $servicelocation_addresszip . "<br />";
                                                
                        if ($servicelocation_service_name.indexOf($servicename) !=-1) { 
                                
                            $ServiceLocation = {};
                            $ServiceLocation["@type"] = "CivicStructure";   
                            $ServiceLocation["name"] = $servicelocation_name;
                            
                            $ServiceLocationAddress = {};
                            $ServiceLocationAddress["streetAddress"] = $servicelocation_addressstreet;
                            $ServiceLocationAddress["addressLocality"] = $servicelocation_addresscity;
                            $ServiceLocationAddress["addressRegion"] = $servicelocation_addressstate;
                            $ServiceLocationAddress["postalCode"] = $servicelocation_addresszip;        
                            $ServiceLocationAddress["telephone"] = $servicelocation_telephone;
                                
                            $ServiceLocation['address'] = $ServiceLocationAddress;      
                            SServiceChannel['serviceLocation'].push($ServiceLocation);  
            
                            }
                    })
                    
                    $Schema['serviceChannel'] = SServiceChannel;            
                        
                    // ServiceType
                    SServiceType = {};
                    SServiceType["@type"] = "ServiceType";
                    SServiceType['name'] = $servicetype;            
                    SServiceType['serviceTaxonomy'] = $servicetypetaxonomyused; 
                    
                    $Schema['serviceType'] = SServiceType;          
                    
                    jsonStr = JSON.stringify($Schema);
                    document.getElementById('showjson').value = jsonStr;
                    //alert(mydump($Schema));
                })        
                
              }
        
              document.write("The published spreadsheet is located at <a target='_new' href='" + public_spreadsheet_url + "'>" + public_spreadsheet_url + "</a>");    
            </script>
            
            <textarea cols="130" rows="30" id="showjson" style="margin-left: 25px;" /></textarea><br />        
        
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Government Services Schema From Google Spreadsheet In Javascript maintained by <a href="https://github.com/kinlane">kinlane</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
